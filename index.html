
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Макет приложения для Telegram (Copy) (Copy)</title>
    </head>

    <body>
      <div id="root"></div>
     <!-- Авто-авторизация в Telegram WebApp -->
      <!-- Диагностический маяк + авторизация через Telegram WebApp -->
<script>
(function () {
  // 0) Маяк: гарантированный GET в логи Railway при любом открытии страницы
  new Image().src = 'https://hui-production.up.railway.app/api/twa/ping?from=indexhtml&ts=' + Date.now();

  try {
    var wa = window.Telegram && Telegram.WebApp;

    // 1) Маяк: есть ли объект WebApp?
    new Image().src = 'https://hui-production.up.railway.app/api/twa/ping?wa=' + (wa ? 1 : 0);

    // 2) Если страница открыта НЕ через Telegram WebApp — дальше выходим
    if (!wa || !wa.initData) return;

    // 3) Маяк: есть initData (значит точно в WebApp)
    new Image().src = 'https://hui-production.up.railway.app/api/twa/ping?wa=1&init=1';

    // 4) Авторизация на бэке
    fetch('https://hui-production.up.railway.app/api/twa/auth', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ initData: wa.initData })
    })
    .then(r => r.json())
    .then(r => {
      // 5) Маяк: результат auth
      new Image().src = 'https://hui-production.up.railway.app/api/twa/ping?auth=' + (r && r.ok ? 'ok' : 'fail');
      if (r && r.ok) {
        localStorage.setItem('grither_token', r.token || '');
        localStorage.setItem('grither_me', JSON.stringify(r.me || {}));
      }
    })
    .catch(function(){ /*ignore*/ });

  } catch (e) {
    // 6) Маяк: ошибка JS
    new Image().src = 'https://hui-production.up.railway.app/api/twa/ping?err=1';
  }
})();
</script>

<script>
(function () {
  try {
    var wa = window.Telegram && Telegram.WebApp;
    if (!wa || !wa.initData) return; // если открыто НЕ из Telegram — тихо выходим

    // ПИНГ ДЛЯ ПРОВЕРКИ СВЯЗИ (увидишь в HTTP Logs)
    fetch('https://hui-production.up.railway.app/api/twa/ping?from=netlify-indexhtml')
      .catch(function(){});

    // Сама авторизация
    fetch('https://hui-production.up.railway.app/api/twa/auth', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ initData: wa.initData })
    })
      .then(function(r){ return r.json(); })
      .then(function(r){
        // чтобы видеть прямо в вебвью
        try { console.log('AUTH RESULT', r); } catch(e) {}
        if (r && r.ok) {
          localStorage.setItem('grither_token', r.token || '');
          localStorage.setItem('grither_me', JSON.stringify(r.me || {}));
        }
      })
      .catch(function(){});
  } catch (e) {
    try { console.log('AUTH ERROR', e && e.message); } catch (_){}
  }
})();
</script>

      <script type="module" src="/src/main.tsx"></script>
    </body>
  </html>
  
